# UI Fixes Task List – December 6, 2025

---

## Master Checklist

### Quick Wins (CSS/Layout fixes)
- [ ] **Task 2** – Variant Selector Overruns Bottom _(CSS height/overflow fix)_
- [ ] **Task 4** – Mobile Tool Buttons Two per Row _(flexbox/grid tweak)_
- [ ] **Task 5** – Remove Extra Flip, Move Edit Button _(button rearrangement)_

### Task Pane Cluster (same hooks/components)
- [ ] **Task 3** – Task Filter Should Apply Across All Pages _(server-side filter)_
- [ ] **Task 11** – Task Filter Not Showing Some Task Types _(filter/config mismatch)_

### Video Timeline Cluster
- [ ] **Task 8** – Selected Segment Fill Color Disappears
- [ ] **Task 9** – iPad Segment Marker Taps Trigger Text Selection

### Mobile/Thumbnail Issues
- [ ] **Task 6** – Segment Thumbnails Not Showing (Mobile)

### Navigation/Variant Selection
- [ ] **Task 7** – Open Correct Variant When Clicking Item

### Pipeline/Data Issues
- [ ] **Task 10** – Edited Videos Not Appearing in Gallery

### Complex/Research Required
- [ ] **Task 1** – Repositioning Should Scale Settings with Canvas Size

---

## Task 1 – Repositioning Should Scale Settings with Canvas Size ⏸️

**Area:** Image editor → Repositioning / canvas-based transforms

**Description:**
When using the repositioning mode, the underlying settings for the image (position, scale, etc.) should be adjusted **proportionally to the canvas/screen size**. If the canvas is smaller, the saved settings for new images should reflect this scaling, so behavior is consistent across different screen sizes.

**Requirements:**
* Base repositioning (move/scale/etc.) on values that are **normalized to the canvas size**.
* When the canvas/screen is smaller, adjust the stored transform settings proportionally.
* Ensure saved settings are resolution-/canvas-independent (e.g., percentages or normalized coordinates).
* Produce visually consistent results regardless of device or viewport size.

**Impacted Files:**
- `src/shared/components/MediaLightbox/hooks/useRepositionMode.ts` – Main reposition logic; stores `translateX`/`translateY` in pixels
- `src/shared/components/MediaLightbox/components/controls/RepositionControls.tsx` – Sliders use `imageDimensions` for max translate
- `src/shared/components/MediaLightbox/components/MediaDisplayWithCanvas.tsx` – Applies transform style to image

**Execution Notes:**
_(Fill during/after implementation)_

**Additional Data Needed:** None

**Testing Instructions:**
1. Open repositioning mode on desktop (large canvas)
2. Apply a transform (e.g., translateX = 100px)
3. Save the image
4. Open the same repositioning on mobile (small canvas)
5. Verify the visual result matches the desktop version proportionally

---

## Task 2 – Variant Selector Overruns Bottom of Screen ⏸️

**Area:** Media / editor UI → Variant selector (bottom bar)

**Description:**
The **variant selector** at the bottom of the screen still **overruns / extends far beyond** the bottom on some views.

**Observed Behavior:**
* The bottom variant strip extends beyond the viewport on mobile.
* Requires unnecessary scrolling or causes visual clipping.

**Requirements:**
* Fix the layout so it fits entirely within the visible bottom area.
* Adjust heights, overflow rules, and container structure.
* Verify on mobile (primary) and desktop/tablet.

**Impacted Files:**
- `src/tools/travel-between-images/components/VideoGallery/components/VideoTrimEditor/components/VariantSelector.tsx` – The variant grid; uses `grid-cols-4` layout
- `src/shared/components/MediaLightbox/MediaLightboxRefactored.tsx` – Lines ~2219: wraps VariantSelector with `max-h-[50%]`
- `src/shared/components/MediaLightbox/components/EditModePanel.tsx` – Lines ~528-537: another VariantSelector usage

**Execution Notes:**
_(Fill during/after implementation)_

**Additional Data Needed:** None

**Testing Instructions:**
1. Open media lightbox with multiple variants on mobile
2. Verify variant selector does not extend past screen bottom
3. Scroll within the variant area if needed
4. Test on desktop to ensure no regressions

---

## Task 3 – Task Filter Should Apply Across All Pages ⏸️

**Area:** Task Pane → Task filter / pagination

**Description:**
When using the **task filter**, it currently appears to only filter tasks on the **current page** of results. The filter should apply to **all tasks across all pages**.

**Observed Behavior:**
* Filtering only affects the currently loaded page, not the full dataset.
* Pagination doesn't reflect the filtered result set.

**Requirements:**
* Update filtering logic so filters apply over the **entire task collection**.
* Pagination should reflect the filtered result set.
* Task count and pages should update correctly when a filter is active.
* Consider server-side filtering for performance.

**Impacted Files:**
- `src/shared/hooks/useTasks.ts` – `usePaginatedTasks` (line ~261): server-side query; `useDistinctTaskTypes` (line ~806) for filter options
- `src/shared/components/TasksPane/TasksPane.tsx` – `selectedTaskType` state (line ~180); passes to TaskList
- `src/shared/components/TasksPane/TaskList.tsx` – Client-side `taskTypeFilter` applied in `filteredTasks` useMemo (line ~107)

**Execution Notes:**
_(Fill during/after implementation)_

**Additional Data Needed:** None

**Testing Instructions:**
1. Open Tasks Pane with many tasks across multiple pages
2. Apply a task type filter
3. Verify pagination updates to show only filtered tasks
4. Navigate to page 2+ and verify filter is still applied
5. Clear filter and verify full list returns

---

## Task 4 – Wrap Mobile Tool Buttons Two per Row in Floating Tool Selector ⏸️

**Area:** Mobile UI → Floating tool selector

**Description:**
On mobile, the **tool buttons** in the floating tool selector run over the edge of the container, causing horizontal overflow.

**Observed Behavior:**
* Tool buttons overflow horizontally on mobile.

**Requirements:**
* Arrange tool buttons **two per row** on mobile.
* Ensure spacing and tap targets remain comfortable.
* Desktop/tablet layouts should remain unchanged.

**Impacted Files:**
- `src/shared/components/MediaLightbox/components/FloatingToolControls.tsx` – Mode toggle at line ~109: `flex items-center gap-0.5`; needs grid layout on mobile

**Execution Notes:**
_(Fill during/after implementation)_

**Additional Data Needed:** None

**Testing Instructions:**
1. Open image edit mode on mobile
2. View the floating tool controls
3. Verify buttons are arranged 2 per row
4. Verify no horizontal overflow
5. Test on desktop – verify no change

---

## Task 5 – Adjust Buttons in Media Lightbox (Remove Extra Flip, Move Edit Button) ⏸️

**Area:** Media lightbox UI

**Description:**
Remove the **redundant flip button** and position the **Edit** button in the **top-left** of the lightbox.

**Requirements:**
* Identify and remove the secondary flip button.
* Move/place the Edit button in the top-left corner.
* Ensure remaining controls are laid out cleanly.
* Verify on desktop and mobile.

**Impacted Files:**
- `src/shared/components/MediaLightbox/components/ButtonGroups.tsx` – `TopLeftControls` (line ~47): has flip button
- `src/shared/components/MediaLightbox/components/MediaControls.tsx` – Lines ~229-262: another flip button in the controls bar
- `src/shared/components/MediaLightbox/MediaLightboxRefactored.tsx` – Imports and positions button groups

**Execution Notes:**
_(Fill during/after implementation)_

**Additional Data Needed:** None

**Testing Instructions:**
1. Open media lightbox for an image
2. Verify only one flip button exists
3. Verify Edit button is in top-left
4. Test on mobile and desktop

---

## Task 6 – Segment Thumbnails Not Showing for Selected Portions (Mobile) ⏸️

**Area:** Mobile UI → Segment thumbnails / selection

**Description:**
On **mobile**, the **segment thumbnails** for selected portions are not appearing.

**Observed Behavior:**
* Selecting a segment on mobile doesn't show the thumbnail preview.

**Requirements:**
* Investigate why segment thumbnails aren't rendered on mobile.
* Ensure selecting a segment shows the correct thumbnail.
* Thumbnails should update when selection changes.
* Confirm desktop behavior remains correct.

**Impacted Files:**
- `src/tools/edit-video/components/VideoPortionEditor.tsx` – `SegmentThumbnail` component (line ~16): canvas-based thumbnail capture
- `src/shared/components/VideoPortionTimeline/index.tsx` – `FrameThumbnail` component usage in timeline

**Execution Notes:**
_(Fill during/after implementation)_

**Additional Data Needed:** Debug tag `[SegmentThumbMobile]` if logs added

**Testing Instructions:**
1. Open edit video on mobile
2. Select a segment/portion
3. Verify thumbnail previews appear for start/end
4. Change selection and verify thumbnails update
5. Test on desktop – verify no regression

---

## Task 7 – Open Correct Variant When Clicking Item (Edit Images & Edit Videos) ⏸️

**Area:** Edit Images page / Edit Videos page → Item selection & variants

**Description:**
When clicking into an item, it should open **that specific variant** rather than a default or different variant.

**Requirements:**
* Update item click behavior to open with the exact variant active.
* Pass correct variant data (ID, metadata) into the editor.
* Variant strip should reflect the selected variant.
* Verify on both Edit Images and Edit Videos pages.

**Impacted Files:**
- `src/tools/edit-images/pages/EditImagesPage.tsx` – `handleResultClick` (line ~207): sets `lightboxVariantId`
- `src/tools/edit-video/pages/EditVideoPage.tsx` – `onImageClick` handler (line ~377): sets `lightboxVariantId`
- `src/shared/components/MediaLightbox/MediaLightboxRefactored.tsx` – Receives variant ID and should pre-select it
- `src/shared/components/ImageGalleryItem.tsx` – `onOpenLightbox` callback (line ~1729)

**Execution Notes:**
_(Fill during/after implementation)_

**Additional Data Needed:** None

**Testing Instructions:**
1. Go to Edit Images page with multiple results
2. Click a specific item in the results gallery
3. Verify lightbox opens with that exact variant selected
4. Check variant strip shows correct selection
5. Repeat for Edit Videos page

---

## Task 8 – Selected Segment Fill Color Between Markers Sometimes Disappears ⏸️

**Area:** Edit Video page → Segment selection UI

**Description:**
The **fill color** between the two segment markers sometimes disappears while the markers remain visible.

**Observed Behavior:**
* A segment is selected with visible markers.
* The fill/highlight between markers occasionally vanishes.

**Requirements:**
* Investigate rendering logic for segment fill.
* Ensure fill remains visible while segment is selected.
* Check for interactions that may cause the fill to vanish (scrolling, resizing, timeline updates).
* Verify on desktop and mobile.

**Impacted Files:**
- `src/shared/components/VideoPortionTimeline/index.tsx` – Lines ~342-357: "Selected portion highlight" div with conditional opacity
- `src/tools/travel-between-images/components/Timeline/PairRegion.tsx` – Pair region rendering with bg classes (line ~75)

**Execution Notes:**
_(Fill during/after implementation)_

**Additional Data Needed:** Debug tag `[SegmentFillDebug]` if logs added

**Testing Instructions:**
1. Open edit video page
2. Select a segment
3. Verify fill color is visible between markers
4. Scroll, resize, or interact with timeline
5. Verify fill remains visible throughout

---

## Task 9 – iPad Segment Marker Taps Trigger Text Selection ⏸️

**Area:** Edit Video page → Segment markers (iPad)

**Description:**
On **iPad**, tapping segment start/end markers sometimes triggers **text selection mode** instead of adjusting the markers.

**Observed Behavior:**
* Tapping near segment handle enters text-selection mode on underlying text.

**Requirements:**
* Adjust interaction handling on iPad to capture taps in the segment control area.
* Prevent default text-selection behavior for taps within the control.
* Ensure segment/timeline region covers the tap area.
* Test on iPad (physical or simulated).

**Impacted Files:**
- `src/shared/components/VideoPortionTimeline/index.tsx` – Lines ~359-397: Start/end handle divs with touch handlers
- `src/tools/travel-between-images/components/VideoGallery/components/VideoTrimEditor/components/TrimTimelineBar.tsx` – Pointer event handlers (line ~45)

**Execution Notes:**
_(Fill during/after implementation)_

**Additional Data Needed:** None

**Testing Instructions:**
1. Open edit video on iPad
2. Tap on segment start/end markers
3. Verify markers move without triggering text selection
4. Verify no text-selection highlighting appears

---

## Task 10 – Edited Videos Not Appearing in Gallery (Edit Videos Tool) ⏸️

**Area:** Edit Videos tool → Task pipeline → Gallery display

**Description:**
When a video is edited via the Edit Videos tool, the resulting edited video is **not** showing up in the gallery.

**Requirements:**
* Trace the entire pipeline: Create Task → Complete Task → Gallery Display.
* Identify where the edited video is getting lost (missing associations, flags, or wrong collection key).
* Fix the pipeline so edited videos always appear in the gallery.
* Add logging/checks for future regressions.

**Impacted Files:**
- `src/tools/edit-video/pages/EditVideoPage.tsx` – Results query (lines ~359-398): uses `ImageGallery` with `allResults`
- `src/shared/components/ImageGallery/components/ImageGalleryLightbox.tsx` – How items are displayed
- Check supabase edge function for `edit_video_orchestrator` task completion

**Execution Notes:**
_(Fill during/after implementation)_

**Additional Data Needed:** Debug tag `[EditVideoGallery]` if logs added

**Testing Instructions:**
1. Go to Edit Videos tool
2. Select a video and apply an edit
3. Wait for task to complete
4. Check the "Edited Videos" gallery section
5. Verify the edited video appears

---

## Task 11 – Task Filter Not Showing Some Task Types (e.g., Image Inpaint) ⏸️

**Area:** Task Pane → Task filter by type

**Description:**
Some task types (e.g., **Image Inpaint**) are not appearing in the task filter results, even when they exist.

**Observed Behavior:**
* "Image Inpaint" tasks exist but don't show when filtering by their type.
* The filter appears to miss or misclassify certain task types.

**Requirements:**
* Investigate how task types are stored and mapped to filter options.
* Ensure all valid task types are represented in the filter.
* Fix mismatches between task type labels/keys and filter expectations.
* Add diagnostic to surface unmapped task types.

**Impacted Files:**
- `src/shared/lib/taskConfig.ts` – `TASK_TYPE_CONFIG` registry (line ~25); `image_inpaint` is defined at line ~132
- `src/shared/hooks/useTasks.ts` – `useDistinctTaskTypes` (line ~806): queries task_types table; falls back to `isTaskVisible()`
- `src/shared/components/TasksPane/TaskList.tsx` – `taskTypeFilter` applied at line ~112

**Execution Notes:**
_(Fill during/after implementation)_

**Additional Data Needed:** Debug tag `[TaskTypeFilter]` if logs added

**Testing Instructions:**
1. Create some Image Inpaint tasks
2. Open Tasks Pane
3. Open the task type filter dropdown
4. Verify "Image Inpaint" appears in options
5. Select it and verify inpaint tasks are shown

